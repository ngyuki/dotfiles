#!/bin/bash

set -eu

if [ -n "${1-}" ]; then
  dir=$1
else
  dir=$PWD
fi

if [ ! -d "$dir" ]; then
  echo "$dir is no directory" 1>&2
  exit 1
fi

dir=$(cd "$dir";pwd)
mnt="$HOME/.bind/${dir#/}"

if [ "$(cat /etc/mtab | cut -d' ' -f2 | grep -F "$dir")" == "$dir" ]; then
  echo "$dir is mounted" 1>&2
  exit 1
fi

echo "mount --bind \"$mnt\" \"$dir\""

mkdir -p "$mnt"
sudo umount "$mnt" 2>/dev/null &&:
sudo mount --bind "$mnt" "$dir"
